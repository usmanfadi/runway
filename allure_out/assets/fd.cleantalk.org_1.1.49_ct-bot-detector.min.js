if(!window.BOT_DETECTOR_LOADED){window.BOT_DETECTOR_LOADED=!0;class a{static moderateUrl="https://fd.cleantalk.org/api3.0/frontend_data";static endpoints={moderate:["frontend_data"]};static send(r,s){return new Promise((t,o)=>{let a;if(-1===this.endpoints.moderate.indexOf(r))o(new Error("Method name unknown. "+r));else{a=new URL(this.moderateUrl);let e=new XMLHttpRequest;e.open("POST",a),e.timeout=15e3,e.setRequestHeader("Content-Type","application/json"),s.method_name=r,e.send(JSON.stringify(s)),e.onload=()=>{t(e)},e.onerror=()=>{o(new Error("Connection error. "+a.toString()))}}})}}class b{constructor(){this.storageKey="bot_detector_cron_storage",this.cronEventName="cronHubEvent",this.tickStep=500,this.tickFirst=500,this.ticksCount=0,this.taskTemplate={firstRunOnStep:1,runEveryNStep:2,clientInfoGetter:"",event:"",log:{getter_last_call:0,getter_calls_count:0}},this.initializeStorage(),this.scheduleTasks()}runService(){this.ticksCount=0,setTimeout(()=>{setInterval(()=>this.tick(),this.tickStep)},this.tickFirst)}tick(){this.ticksCount++;var e=this.collectClientInfo();this.isClientInfoReady(e)&&botDetectorSendClientInfoToCloud(this.mergeClientInfo(e),this.cronEventName)}collectClientInfo(){var t,e,o=this.getStorage(),a={};for([t,e]of Object.entries(o))try{this.shouldRunTask(e)&&this.isValidGetter(e.clientInfoGetter)&&(a[t]=this[e.clientInfoGetter](),this.isClientInfoReady(a))&&(o[t].log.getter_last_call=Math.floor(Date.now()/1e3),o[t].log.getter_calls_count++,this.setStorage(o))}catch(e){console.error(`Error executing getter for event "${t}":`,e)}return a}isValidGetter(e){return"function"==typeof this[e]}shouldRunTask(e){return this.ticksCount>=e.firstRunOnStep&&this.ticksCount%e.runEveryNStep==0}isClientInfoReady(e){return e&&"object"==typeof e&&0<Object.keys(e).length&&Object.values(e).some(e=>e&&e.agent&&e.timestamp&&2<Object.keys(e).length)}mergeClientInfo(e){var t,o={};for(t of Object.values(e))for(var[a,r]of Object.entries(t))null===r?o[a]=null:o[a]=r;return o}initializeStorage(){this.setStorage({})}getStorage(){return d.get(this.storageKey)||{}}setStorage(e){e&&"object"==typeof e?d.set(this.storageKey,e):console.error("Invalid storage data format")}addTask(e,t,o,a){if("string"!=typeof e||""===e.trim())throw new Error("Invalid event name: must be a non-empty string");if("string"!=typeof t||""===t.trim())throw new Error("Invalid clientInfoGetter: must be a non-empty string");if(void 0!==o&&(!Number.isInteger(o)||o<0))throw new Error("firstRunOnStep must be a non-negative integer");if(void 0!==a&&(!Number.isInteger(a)||a<=0))throw new Error("runEveryNStep must be a positive integer");e={...this.taskTemplate,event:e.trim(),clientInfoGetter:t.trim(),firstRunOnStep:Number.isInteger(o)?o:this.taskTemplate.firstRunOnStep,runEveryNStep:Number.isInteger(a)?a:this.taskTemplate.runEveryNStep};this.updateTaskInStorage(e)}updateTaskInStorage(e){var t=this.getStorage();t[e.event]=e,this.setStorage(t)}scheduleTasks(){this.addTask("send_typo_data","getTypoData",1,5),this.addTask("send_pointer_data","getPointerData",3,5),this.addTask("send_fingerprint_data","getFingerprint",1,5),this.addTask("send_scrolling_data","getScrollingParameters",3,5)}getTypoData(){var e=botDetectorCreateClientInfo();if(document.typoData?.data)for(var t in document.typoData.data){t=document.typoData.data[t];if(0<t.lastKeyTimestamp&&t.lastKeyTimestamp>Date.now()-l){e.typo=document.typoData.data;break}}return e}getPointerData(){var e=botDetectorCreateClientInfo(),t=d.get("bot_detector_pointer_data")||0;return 0!==t&&t.length&&m.last_data_length!==t.length&&(e.pointer_data=t,m.send_on_stop_collect&&(m.last_data_length=t.length,m.send_on_stop_collect=!1,m.send_on_cron=!1),m.send_on_cron)&&(m.last_data_length=t.length),e}getFingerprint(){var e=botDetectorCreateClientInfo(),t=d.get("bot_detector_f_hash");return!1===t?.sent&&(t.sent=Math.floor(Date.now()/1e3),d.set("bot_detector_f_hash",t),e.f_hash_data=t),e}getScrollingParameters(){var e=botDetectorCreateClientInfo(),t=d.isSet("bot_detector_scrolling_additional")?d.get("bot_detector_scrolling_additional","value"):0;return 0!==t&&void 0!==t.length&&u.last_data_length!==t.length&&(e.scrolling_additional=t,u.last_data_length=t.length),e}}class c{allParams={};paramStatus={};paramEntropy={};paramCategory={};async collectFingerprint(){try{this.addParam("screen_resolution",screen.width+"x"+screen.height,"success","high","display"),this.addParam("screen_width",screen.width,"success","high","display"),this.addParam("screen_height",screen.height,"success","high","display"),this.addParam("color_depth",screen.colorDepth,"success","high","display"),this.addParam("screen_color_depth",screen.colorDepth,"success","high","display"),this.addParam("screen_pixel_depth",screen.pixelDepth,"success","medium","display"),this.addParam("screen_availWidth_availHeight",screen.availWidth+"x"+screen.availHeight,"success","medium","display"),this.addParam("screen_avail_width",screen.availWidth,"success","medium","display"),this.addParam("screen_avail_height",screen.availHeight,"success","medium","display"),this.addParam("window_devicePixelRatio",Math.round(10*(window.devicePixelRatio||1))/10,"success","medium","display"),this.addParam("device_pixel_ratio",Math.round(10*(window.devicePixelRatio||1))/10,"success","medium","display"),screen.orientation?(this.addParam("screen_orientation_angle",screen.orientation.angle,"success","low","display"),this.addParam("screen_orientation_type",screen.orientation.type,"success","low","display")):(this.addParam("screen_orientation_angle","unavailable","error","low","display"),this.addParam("screen_orientation_type","unavailable","error","low","display")),this.addParam("platform",navigator.platform,"success","high","system"),this.addParam("hardware_concurrency",navigator.hardwareConcurrency||"unavailable","success","high","hardware"),this.addParam("navigator_maxTouchPoints",navigator.maxTouchPoints||0,"success","medium","hardware"),this.addParam("max_touch_points",navigator.maxTouchPoints||0,"success","medium","hardware"),this.addParam("touch_support","ontouchstart"in window,"success","medium","hardware"),this.addParam("gamepad_support","getGamepads"in navigator,"success","low","hardware"),this.addParam("timezone_offset",(new Date).getTimezoneOffset(),"success","high","system"),this.addParam("timezone",Intl.DateTimeFormat().resolvedOptions().timeZone,"success","high","system"),this.addParam("time_zone_combined",(new Date).getTimezoneOffset()+"_"+Intl.DateTimeFormat().resolvedOptions().timeZone,"success","high","system"),this.addParam("intl_timezone",Intl.DateTimeFormat().resolvedOptions().timeZone,"success","high","system"),this.addParam("intl_calendar",Intl.DateTimeFormat().resolvedOptions().calendar||"unavailable","success","low","system"),this.addParam("intl_numbering_system",Intl.DateTimeFormat().resolvedOptions().numberingSystem||"unavailable","success","low","system"),this.addParam("navigator_webdriver",navigator.webdriver||!1,"success","high","browser"),this.addParam("app_name",navigator.appName||"unavailable","success","low","browser"),this.addParam("product",navigator.product||"unavailable","success","low","browser"),this.addParam("webdriver",navigator.webdriver||!1,"success","high","browser");var t=[];for(let e=0;e<navigator.plugins.length;e++)t.push(navigator.plugins[e].name);this.addParam("navigator_plugins",t.join(","),"success","high","browser"),this.addParam("plugins_length",navigator.plugins.length,"success","high","browser");var o=[];for(let e=0;e<navigator.mimeTypes.length;e++)o.push(navigator.mimeTypes[e].type);this.addParam("navigator_mimeTypes",o.join(","),"success","medium","browser"),this.addParam("mime_types_length",navigator.mimeTypes.length,"success","medium","browser");try{document.createElement("canvas").getContext("2d");this.addParam("OffscreenCanvas_support","undefined"!=typeof OffscreenCanvas,"success","medium","canvas")}catch(e){this.addParam("canvas_error",e.message,"error","high","canvas")}var e=this.getWebGLParams();Object.entries(e).forEach(([e,t])=>{var o=["UNMASKED_VENDOR","MAX_TEXTURE_SIZE","MAX_ANISOTROPY"].includes(e)?"high":"medium";this.addParam(e,t,"error"===t?"error":"success",o,"webgl")}),Object.entries(e).forEach(([e,t])=>{e="webgl_"+e.toLowerCase();this.allParams[e]||"webgl_renderer"==e||"webgl_shading_language_version"==e||"webgl_vendor"==e||"webgl_version"==e||"webgl_unmasked_renderer"==e||"webgl_supported_webgl_extensions"==e||this.addParam(e,t,"error"===t?"error":"success","medium","webgl")});try{var a,r=document.createElement("canvas"),s=r.getContext("webgl")||r.getContext("experimental-webgl"),n=(s&&(this.addParam("webgl_isContextLost",s.isContextLost(),"success","low","webgl"),a=new Uint8Array(4),s.readPixels(0,0,1,1,s.RGBA,s.UNSIGNED_BYTE,a),this.addParam("readPixels",Array.from(a).join(","),"success","high","webgl")),r.getContext("webgl2"));this.addParam("webgl2_supported",null!==n,"success","medium","webgl")}catch(e){this.addParam("webgl_additional_error",e.message,"error","medium","webgl")}try{var i=["Arial","Arial Black","Calibri","Cambria","Comic Sans MS","Consolas","Courier New","Georgia","Helvetica","Impact","Lucida Console","Monaco","Palatino","Tahoma","Times New Roman","Trebuchet MS","Verdana"];let e=["monospace","sans-serif","serif"],a="mmmmmmmmmmlli",r=document.createElement("canvas").getContext("2d"),s={},n=(e.forEach(e=>{r.font="72px "+e,s[e]=r.measureText(a).width}),[]);i.forEach(t=>{let o=!1;e.forEach(e=>{r.font=`72px "${t}", `+e,r.measureText(a).width!==s[e]&&(o=!0)}),o&&n.push(t)}),this.addParam("font_availability",n.join(","),"success","high","fonts"),this.addParam("available_fonts",n.join(","),"success","high","fonts"),this.addParam("font_rendering",n.length,"success","high","fonts"),this.addParam("available_fonts_count",n.length,"success","high","fonts")}catch(e){this.addParam("font_error",e.message,"error","high","fonts")}try{this.addParam("performance_now","function"==typeof performance.now,"success","low","performance")}catch(e){this.addParam("performance_error",e.message,"error","medium","performance")}this.addParam("matchMedia_reducedMotion",window.matchMedia("(prefers-reduced-motion: reduce)").matches,"success","low","display"),this.addParam("prefers_reduced_motion",window.matchMedia("(prefers-reduced-motion: reduce)").matches,"success","low","display"),this.addParam("matchMedia_colorScheme",window.matchMedia("(prefers-color-scheme: dark)").matches,"success","low","display"),this.addParam("prefers_color_scheme_dark",window.matchMedia("(prefers-color-scheme: dark)").matches,"success","low","display"),this.addParam("prefers_color_scheme_light",window.matchMedia("(prefers-color-scheme: light)").matches,"success","low","display"),this.addParam("matchMedia_forcedColors",window.matchMedia("(forced-colors: active)").matches,"success","low","display"),this.addParam("forced_colors",window.matchMedia("(forced-colors: active)").matches,"success","low","display"),this.addParam("inverted_colors",window.matchMedia("(inverted-colors: inverted)").matches,"success","low","display"),this.addParam("prefers_contrast_high",window.matchMedia("(prefers-contrast: high)").matches,"success","low","display"),this.addParam("any_hover",window.matchMedia("(any-hover: hover)").matches,"success","low","display"),this.addParam("any_pointer_coarse",window.matchMedia("(any-pointer: coarse)").matches,"success","low","display"),this.addParam("any_pointer_fine",window.matchMedia("(any-pointer: fine)").matches,"success","low","display");try{if(navigator.permissions){this.addParam("permissions_api",!0,"success","low","browser");var c,d={};for(c of["camera","microphone","geolocation"])try{var l=await navigator.permissions.query({name:c});d[c]=l.state,"camera"===c?this.addParam("permission_camera",l.state,"success","medium","browser"):"microphone"===c&&this.addParam("permission_microphone",l.state,"success","medium","browser")}catch(e){d[c]="error"}this.addParam("permissions",JSON.stringify(d),"success","medium","browser")}else this.addParam("permissions_api",!1,"error","low","browser"),this.addParam("permissions","unavailable","error","medium","browser")}catch(e){this.addParam("permissions_error",e.message,"error","medium","browser")}try{let a=document.createElement("video");var _={codec_h264:'video/mp4; codecs="avc1.42E01E"',codec_vp8:'video/webm; codecs="vp8"',codec_vp9:'video/webm; codecs="vp9"',codec_av1:'video/mp4; codecs="av01.0.00M.08"',codec_aac:'audio/mp4; codecs="mp4a.40.2"',codec_opus:'audio/webm; codecs="opus"',codec_vorbis:'audio/ogg; codecs="vorbis"'};let r=[];Object.entries(_).forEach(([e,t])=>{var o=a.canPlayType(t),o="probably"===o||"maybe"===o;this.addParam(e,o,"success","medium","media"),o&&r.push(t)}),this.addParam("video_codecs",r.join(","),"success","medium","media")}catch(e){this.addParam("video_codecs_error",e.message,"error","medium","media")}this.addParam("cookie_enabled",navigator.cookieEnabled,"success","low","browser"),this.addParam("pdf_viewer_enabled",navigator.pdfViewerEnabled||"unavailable","success","low","browser"),this.addParam("credentials_api","credentials"in navigator,"success","low","browser"),this.addParam("webrtc_support","undefined"!=typeof RTCPeerConnection,"success","low","browser"),this.addParam("websocket_support","undefined"!=typeof WebSocket,"success","low","browser"),this.addParam("webassembly_support","undefined"!=typeof WebAssembly,"success","low","browser"),this.addParam("web_assembly","undefined"!=typeof WebAssembly,"success","low","browser"),this.addParam("service_worker_support","serviceWorker"in navigator,"success","low","browser"),this.addParam("service_worker","serviceWorker"in navigator,"success","low","browser"),this.addParam("notification","Notification"in window,"success","low","browser"),this.addParam("push_messaging","PushManager"in window,"success","low","browser"),this.addParam("geolocation","geolocation"in navigator,"success","low","browser"),this.addParam("speech_synthesis","speechSynthesis"in window,"success","low","browser"),this.addParam("local_storage","undefined"!=typeof localStorage,"success","low","browser"),this.addParam("session_storage","undefined"!=typeof sessionStorage,"success","low","browser"),this.addParam("indexed_db","undefined"!=typeof indexedDB,"success","low","browser"),this.addParam("web_sql","undefined"!=typeof openDatabase,"success","low","browser"),this.addParam("storage_quota_api","storage"in navigator&&"estimate"in navigator.storage,"success","low","browser");try{var m,u=document.createElement("canvas");let t=u.getContext("webgl")||u.getContext("experimental-webgl");t&&(m=["WEBGL_debug_renderer_info","WEBGL_debug_shaders"].filter(e=>null!==t.getExtension(e)),this.addParam("SUPPORTED_PRIVILEGED_EXTENSIONS",m.join(","),"success","low","webgl"))}catch(e){this.addParam("privileged_extensions_error",e.message,"error","low","webgl")}}catch(e){this.addParam("main_error",e.message,"error","high","system")}return this.updateHash()}async collectAudioFingerprintData(){var e=await this.getAudioFingerprint();e.error||(this.addParam("audioCtx_sampleRate",e.sampleRate,"success","medium","audio"),this.addParam("audio_sample_rate",e.sampleRate,"success","medium","audio"),this.addParam("audio_context_sample_rate",e.sampleRate,"success","medium","audio"),this.addParam("audioCtx_outputLatency",e.outputLatency,"success","medium","audio"),this.addParam("audio_output_latency",e.outputLatency,"success","medium","audio"),this.addParam("audioCtx_getChannelData",e.channelDataChecksum,"success","high","audio"),this.addParam("audio_destination_channels",e.destination?.channelCount||"unavailable","success","medium","audio"),this.addParam("audio_context_state","closed","success","low","audio"))}async updateHash(){var e=this.getSelectedParams();return this.hashString(e)}async hashString(e){e=(new TextEncoder).encode(e),e=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")}addParam(e,t,o="success",a="medium",r="other"){this.allParams[e]=t,this.paramStatus[e]=o,this.paramEntropy[e]=a,this.paramCategory[e]=r}getSelectedParams(){return Object.keys(this.allParams).sort().map(e=>e+":"+this.allParams[e]).join("|")}getWebGLParams(){var e=document.createElement("canvas");let n=e.getContext("webgl")||e.getContext("experimental-webgl"),o=e.getContext("webgl2");if(!n)return{};let a={};["MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_RENDERBUFFER_SIZE","MAX_VIEWPORT_DIMS","DEPTH_BITS","STENCIL_BITS","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_UNIFORM_VECTORS","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_VARYING_VECTORS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_IMAGE_UNITS","ALIASED_LINE_WIDTH_RANGE","ALIASED_POINT_SIZE_RANGE"].forEach(t=>{try{var e=n.getParameter(n[t]);a[t]=Array.isArray(e)?e.join(","):e}catch(e){a[t]="error"}}),o&&["MAX_3D_TEXTURE_SIZE","MAX_ARRAY_TEXTURE_LAYERS","MAX_DRAW_BUFFERS","MAX_COLOR_ATTACHMENTS","MAX_SAMPLES","MAX_UNIFORM_BUFFER_BINDINGS","MAX_VERTEX_UNIFORM_COMPONENTS","MAX_FRAGMENT_UNIFORM_COMPONENTS","MAX_VERTEX_UNIFORM_BLOCKS","MAX_FRAGMENT_UNIFORM_BLOCKS","MAX_VERTEX_OUTPUT_COMPONENTS","MAX_FRAGMENT_INPUT_COMPONENTS","MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS","MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS","MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS","MIN_PROGRAM_TEXEL_OFFSET","MAX_PROGRAM_TEXEL_OFFSET","MAX_TEXTURE_LOD_BIAS","MAX_UNIFORM_BLOCK_SIZE","UNIFORM_BUFFER_OFFSET_ALIGNMENT","MAX_COMBINED_UNIFORM_BLOCKS","MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS","MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS"].forEach(t=>{try{var e;o[t]&&(e=o.getParameter(o[t]),a[t]=Array.isArray(e)?e.join(","):e)}catch(e){a[t]="error"}});try{var t=n.getExtension("WEBGL_debug_renderer_info");if(t){let e=n.getParameter(t.UNMASKED_VENDOR_WEBGL);e=e&&e.replace(/\s*\(.*?\)\s*/g,"").replace(/\s*Inc\.?\s*/gi,"").trim(),a.UNMASKED_VENDOR=e}var r=n.getExtension("EXT_texture_filter_anisotropic");r&&(a.MAX_ANISOTROPY=n.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT))}catch(e){a.extensions_error=e.message}a.MAJOR_PERFORMANCE_CAVEAT=n.getContextAttributes().failIfMajorPerformanceCaveat||!1;let i={};e=[n.VERTEX_SHADER,n.FRAGMENT_SHADER];let c=[n.LOW_FLOAT,n.MEDIUM_FLOAT,n.HIGH_FLOAT,n.LOW_INT,n.MEDIUM_INT,n.HIGH_INT];return e.forEach((r,e)=>{let s=0===e?"vertex":"fragment";c.forEach((e,t)=>{try{var o,a=n.getShaderPrecisionFormat(r,e);a&&(o=["lowFloat","mediumFloat","highFloat","lowInt","mediumInt","highInt"][t],i[s+"_"+o]=`${a.precision},${a.rangeMin},`+a.rangeMax)}catch(e){}})}),a.FLOAT_INT_PRECISION=JSON.stringify(i),a}async getAudioFingerprint(){try{var e=window.AudioContext||window.webkitAudioContext;if(!e)return{};var t=new e,o={sampleRate:t.sampleRate,outputLatency:t.outputLatency||"unavailable",destination:{maxChannelCount:t.destination.maxChannelCount,channelCount:t.destination.channelCount}},a=t.createOscillator(),r=t.createAnalyser(),s=t.createGain(),n=t.createScriptProcessor(4096,1,1);a.type="triangle",a.frequency.value=1e3,s.gain.value=0,a.connect(r),r.connect(n),n.connect(s),s.connect(t.destination),a.start(),await new Promise(e=>setTimeout(e,100));var i=t.createBuffer(1,.1*t.sampleRate,t.sampleRate).getChannelData(0);for(let e=0;e<i.length;e++)i[e]=Math.sin(2*Math.PI*440*e/t.sampleRate);return o.channelDataChecksum=i.slice(0,100).reduce((e,t)=>e+t,0).toFixed(4),a.stop(),n.disconnect(),r.disconnect(),s.disconnect(),a.disconnect(),await t.close(),o}catch(e){return{error:e.message}}}}class d{static maxLifetime=600;static get(e,t){void 0===t&&(t="value");e=localStorage.getItem(e);if(null!==e)try{var o=JSON.parse(e);return o.hasOwnProperty(t)?o[t]:o}catch(e){return new Error(e)}return!1}static set(e,t){t={value:t,timestamp:Math.floor((new Date).getTime()/1e3)};localStorage.setItem(e,JSON.stringify(t))}static isAlive(e,t){return void 0===t&&(t=this.maxLifetime),this.get(e,"timestamp")+t>Math.floor((new Date).getTime()/1e3)}static isSet(e){return null!==localStorage.getItem(e)}static delete(e){localStorage.removeItem(e)}}class e{constructor(){this.logLsName="ct_bot_detector_frontend_data_log",this.logsLimit=10,this.getInstance(),this.enabled=!1}writeLog(e){e.frontend_data=this.filterFrontendData(e.frontend_data),e.responder_data=this.filterResponderData(e.responder_data),e.forms_processed=this.filterFormsProcessed(e.forms_processed),this.instance.records.push(e),this.instance.log_last_update=Math.floor((new Date).getTime()/1e3),this.saveInstance()}getInstance(){this.dropInstance(),this.instance={log_start:Math.floor((new Date).getTime()/1e3),log_last_update:"",records:[]}}validateInstance(e){return"object"==typeof e&&!(!(e.hasOwnProperty("log_start")&&e.hasOwnProperty("log_last_update")&&e.hasOwnProperty("records"))||e.records.length>this.logsLimit)&&Array.isArray(e.records)}dropInstance(){d.delete(this.logLsName)}saveInstance(){this.validateInstance(this.instance)&&d.set(this.logLsName,JSON.stringify(this.instance))}getRecordInstance(){return{success:!1,timestamp_on_send:null,timestamp_on_received:null,frontend_data:{event_token:"",js_event:""},responder_data:{host_name:"",headers:"",new_event_token:""},forms_processed:{forms_count:0,forms_list:[],forms_handling_error:""},error:""}}filterFrontendData(e){return e={event_token:e.hasOwnProperty("event_token")?e.event_token:"",js_event:e.hasOwnProperty("js_event")?e.js_event:""}}filterResponderData(e){return e={host_name:e.hasOwnProperty("host_name")?e.host_name:"",headers:e.hasOwnProperty("headers")?e.headers:"",new_event_token:e.hasOwnProperty("new_event_token")?e.new_event_token:""}}filterFormsProcessed(e){return e={forms_count:e.hasOwnProperty("forms_count")?e.forms_count:0,forms_list:e.hasOwnProperty("forms_list")?e.forms_list:[],forms_handling_error:e.hasOwnProperty("forms_handling_error")?e.forms_handling_error:""}}}class f{fieldData={fieldName:"",fieldType:"",isAutocompleteExist:!1,isAutocomplete:!1,label:"",isUseBuffer:!1,speedDelta:0,firstKeyTimestamp:0,lastKeyTimestamp:0,lastDelta:0,countOfKey:0};fields=document.querySelectorAll("input[type=text], input[type=email], textarea");data=[];gatheringFields(){Array.prototype.slice.call(this.fields).forEach((e,t)=>{var o=Object.assign({},this.fieldData);e.name&&(o.fieldName=e.name),e.nodeName&&(o.fieldType=e.nodeName),e.autocomplete&&"off"!==e.autocomplete&&(o.isAutocompleteExist=!0,o.isAutocomplete=e.autocomplete),e.labels&&0<e.labels.length&&(o.label=e.labels[0].innerText),this.data.push(Object.assign({},o))})}setListeners(){this.fields.forEach((e,t)=>{e.addEventListener("paste",e=>{e&&"object"==typeof e&&e instanceof ClipboardEvent?e.clipboardData.getData("text"):void 0!==window.clipboardData&&window.clipboardData.getData("text"),this.data[t].isUseBuffer=!0})}),this.fields.forEach((e,a)=>{e.addEventListener("input",e=>{this.data[a].countOfKey++;var t,o=+new Date;1===this.data[a].countOfKey?(this.data[a].lastKeyTimestamp=o,this.data[a].firstKeyTimestamp=o):(t=o-this.data[a].lastKeyTimestamp,2===this.data[a].countOfKey?(this.data[a].lastKeyTimestamp=o,this.data[a].lastDelta=t):2<this.data[a].countOfKey&&(this.data[a].speedDelta+=Math.abs(this.data[a].lastDelta-t),this.data[a].lastKeyTimestamp=o,this.data[a].lastDelta=t))})})}}function isFromExcludedFromEventTokenField(e,t){if(void 0!==e.attributes.method&&"get"===e.method)return!0;let o=!1;try{var a=getAllDescendantNodes(e),r={selfAttributes:void 0!==e.attributes&&e.attributes,children:void 0!==a&&a!==[]&&a,parent:void 0!==e.parentNode&&e.parentNode.attributes};if(void 0!==t)for(var s in t){var n=t[s];if("object"==typeof n&&n.hasOwnProperty("signs_to_check")){var i=!(!n.signs_to_check.hasOwnProperty("form_attributes")||""===n.signs_to_check.form_attributes)&&n.signs_to_check.form_attributes,c=!(!n.signs_to_check.hasOwnProperty("form_parent_attributes")||""===n.signs_to_check.form_parent_attributes)&&n.signs_to_check.form_parent_attributes,d=!(!n.signs_to_check.hasOwnProperty("form_children_attributes")||""===n.signs_to_check.form_children_attributes)&&n.signs_to_check.form_children_attributes;if(i&&r.selfAttributes)o=checkAttributesExclusions(r.selfAttributes,i);else if(c&&r.parent)o=checkAttributesExclusions(r.parent,c);else if(d&&r.children)for(var l in r.children){if(o)break;void 0===r.children[l]||isChildExcludedCtServiceField(r.children[l])||(o=checkAttributesExclusions(r.children[l].attributes,d))}if(o)return n}}}catch(e){console.warn("CleanTalk Bot Detector exclusion check error: "+e.message)}return o}function getPregMatchBool(e,t){if("string"==typeof e&&"string"==typeof t){if(""===e||""===t)return!1;if(e.match(t))return!0}return!1}function checkAttributesExclusions(e,t){let o=!1;for(var a in e){if(o)break;"object"==typeof e[a]&&null!==e[a]&&"string"==typeof e[a].nodeValue&&(o=getPregMatchBool(e[a].nodeValue,t))}return o}function getAllDescendantNodes(e,t=[]){t.push(...e.childNodes);for(var o of e.childNodes)getAllDescendantNodes(o,t);return t}function isChildExcludedCtServiceField(e){return"string"==typeof e.id&&(-1!==e.id.indexOf("apbct__email_id")||-1!==e.id.indexOf("apbct_event_id")||-1!==e.id.indexOf("apbct_visible_fields")||-1!==e.id.indexOf("ct_checkjs"))||"string"==typeof e.name&&-1!==e.name.indexOf("ct_no_cookie_hidden_field")}function botDetectorOnAnimationStart(e){("onautofillstart"===e.animationName?botDetectorAutocomplete:botDetectorCancelAutocomplete)(e.target)}function botDetectorOnInput(e){("insertReplacementText"!==e.inputType&&"data"in e?botDetectorCancelAutocomplete:botDetectorAutocomplete)(e.target)}function botDetectorAutocomplete(e){var t;e.hasAttribute("autocompleted")||(e.setAttribute("autocompleted",""),t=new window.CustomEvent("onautocomplete",{bubbles:!0,cancelable:!0,detail:null}),e.dispatchEvent(t))||(e.value="")}function botDetectorCancelAutocomplete(e){e.hasAttribute("autocompleted")&&(e.removeAttribute("autocompleted"),e.dispatchEvent(new window.CustomEvent("onautocomplete",{bubbles:!0,cancelable:!1,detail:null})))}let t="1.1.49",o=(new Date).getTime(),r=[],s=!0,n=0,i=[],l=5e3,_,m={send_on_cron:!0,send_on_stop_collect:!1,last_data_length:0},u={last_data_length:0},h=!1,p=!1,g=!1,v=!1,w=!1,y=!1,E={},S=new e,P=new b;function botDetectorInit(){window.addEventListener("keydown",function(e){let t=!1;"Escape"===e.key&&(h=!0,t=!0),"Backspace"===e.key&&(p=!0,t=!0),"CapsLock"===e.key&&(g=!0,t=!0),"Shift"===e.key&&e.ctrlKey&&(v=!0,t=!0),"Shift"===e.key&&e.altKey&&(w=!0,t=!0),t&&(E.key_esc_pressed=h,E.key_backspace_pressed=p,E.key_capslock_pressed=g,E.key_shift_ctrl_pressed=v,E.key_shift_alt_pressed=w,E.key_mobile_capslock_pressed=y,d.set("bot_detector_list_keys_pressed",E))}),document.addEventListener("input",function(e){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&e.target&&e.target.value&&(e=e.target.value.slice(-1))&&e===e.toUpperCase()&&e!==e.toLowerCase()&&e.match(/[A-ZА-ЯЁ]/)&&(y=!0,E.key_esc_pressed=h,E.key_backspace_pressed=p,E.key_capslock_pressed=g,E.key_shift_ctrl_pressed=v,E.key_shift_alt_pressed=w,E.key_mobile_capslock_pressed=y,d.set("bot_detector_list_keys_pressed",E))},!0),botDetectorGetFingerprint().then(e=>{d.set("bot_detector_f_hash",e)});[["bot_detector_pointer_data",0],["bot_detector_screen_info",botDetectorGetScreenInfo()],["bot_detector_headless",navigator.webdriver]].forEach(e=>{d.set(e[0],e[1])});var e=d.get("bot_detector_page_hits")?d.get("bot_detector_page_hits"):0,e=(d.set("bot_detector_page_hits",parseInt(e)+1),d.get("bot_detector_user_agent")?d.get("bot_detector_user_agent"):window.navigator.userAgent);d.set("bot_detector_user_agent",e),_=botDetectorGetFormsExclusions(),botDetectorStartFormsListeners(),botDetectorSetBrowserCookieSupportFlag(),botDetectorSetWebGlSupportFlag(),botDetectorSetReferrers(),P.runService(),botDetectorFrontendData("DOMContentLoaded"),setInterval(()=>{d.isSet("bot_detector_event_token")&&!d.isAlive("bot_detector_event_token")&&botDetectorFrontendData("automaticRefresh")},3e3);document.typoData=new f,document.typoData.gatheringFields(),document.typoData.setListeners()}function botDetectorGetFormsExclusions(){let e=[];try{e=(e="object"==typeof ctPublic&&!0===ctPublic.hasOwnProperty("bot_detector_forms_excluded"))?JSON.parse(atob(ctPublic.bot_detector_forms_excluded)):[]}catch{}return e}function botDetectorStartFormsListeners(){var t=document.forms;if(0<t.length)for(let e=0;e<t.length;e++)t[e].addEventListener("submit",()=>{botDetectorFrontendData("submit")});botDetectorStartFieldsListening(t)}function botDetectorAttachEventHandler(e,t,o){"function"==typeof window.addEventListener?e.addEventListener(t,o):e.attachEvent(t,o)}function botDetectorRemoveEventHandler(e,t,o){"function"==typeof window.removeEventListener?e.removeEventListener(t,o):e.detachEvent(t,o)}function botDetectorGetScreenInfo(){return{fullWidth:document.documentElement.scrollWidth,fullHeight:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight),visibleWidth:document.documentElement.clientWidth,visibleHeight:document.documentElement.clientHeight}}function botDetectorMouseStopData(){m.send_on_stop_collect=!0,window.removeEventListener("mousemove",botDetectorGetMouseData)}function botDetectorGetMouseData(e){s&&(r.push([Math.round(e.clientY),Math.round(e.clientX),Math.round((new Date).getTime()-o)]),s=!1,new Promise(e=>{setTimeout(()=>e(),150)}).then(()=>{d.set("bot_detector_pointer_data",r),n++,s=!0}),150<=n)&&botDetectorMouseStopData()}function botDetectorSetHasScrolled(){d.isSet("bot_detector_has_scrolled")&&d.isAlive("bot_detector_has_scrolled")&&d.get("bot_detector_has_scrolled")||(d.set("bot_detector_has_scrolled",!0),botDetectorFrontendData("scrolled"))}let T=20,D=window.scrollY||document.documentElement.scrollTop,A=(new Date).getTime(),O=A,k=0,M=0,I=[],C=["timestamp","scrollTop","scrollSpeed","scrollDistance","scrollPercent","scrollEndCount","scrollDelay","scrollCount"];function botDetectorCollectScrollingParameters(){var e=window.scrollY||document.documentElement.scrollTop,t=(new Date).getTime(),o=document.documentElement.scrollHeight||document.body.scrollHeight,a=window.innerHeight||document.documentElement.clientHeight,r=e/(o-a)*100,s=Math.abs(e-D),n=s/((t-A)/1e3),i=(t-O)/1e3;D=e,A=t,O=t,o<=e+a&&k++,M++,I.push([t,e,n,s,r,k,i,M]),I.length>T&&(I=I.slice(I.length-T)),d.set("bot_detector_scrolling_additional",I)}function botDetectorSendScrollingParameters(e){var t,o=d.isSet("bot_detector_scrolling_additional")?d.get("bot_detector_scrolling_additional","value"):0;if(0!==o&&void 0!==o.length&&u.last_data_length!==o.length)return(t=botDetectorCreateClientInfo()).scrolling_additional=o,botDetectorSendClientInfoToCloud(t,e),u.last_data_length=o.length,!0;return!1}function botDetectorSetMouseMoved(){d.isSet("bot_detector_mouse_moved")&&d.isAlive("bot_detector_mouse_moved")&&d.get("bot_detector_mouse_moved")||(d.set("bot_detector_mouse_moved",!0),botDetectorFrontendData("mousemoved"))}function botDetectorStartFieldsListening(t){if((!d.isSet("bot_detector_has_key_up")&&!d.get("bot_detector_has_key_up")||!d.isSet("bot_detector_has_input_focused")&&!d.get("bot_detector_has_input_focused"))&&0<t.length)for(let e=0;e<t.length;e++){var o=t[e].querySelectorAll("input,textarea");for(let e=0;e<o.length;e++)"hidden"!==o[e].type&&(i.push(o[e]),botDetectorAttachEventHandler(o[e],"focus",R),botDetectorAttachEventHandler(o[e],"keyup",N))}}function botDetectorStopFieldsListening(t,o){if(void 0!==i&&0<i.length)for(let e=0;e<i.length;e++)botDetectorRemoveEventHandler(i[e],t,o)}I.push(C);let R=function(){d.isSet("bot_detector_has_input_focused")&&d.get("bot_detector_has_input_focused")||d.set("bot_detector_has_input_focused",!0),botDetectorStopFieldsListening("focus",R)},N=function(){d.isSet("bot_detector_has_key_up")&&d.get("bot_detector_has_key_up")||d.set("bot_detector_has_key_up",!0),botDetectorStopFieldsListening("keyup",N)};function botDetectorSetReferrers(){d.set("bot_detector_referrer",window.location.href),d.set("bot_detector_referrer_previous",document.referrer)}function botDetectorSetBrowserCookieSupportFlag(){if(!d.isSet("bot_detector_browser_supports_cookies")||!d.isAlive("bot_detector_browser_supports_cookies")||!d.get("bot_detector_browser_supports_cookies")){let t=navigator.cookieEnabled;if(!t)try{document.cookie="testcookie="+encodeURIComponent("testcookievalue")+"; path=/",t=-1!==document.cookie.indexOf("testcookie")}catch(e){t=!1}d.set("bot_detector_browser_supports_cookies",t)}}function botDetectorSetWebGlSupportFlag(){var e=document.createElement("canvas");e.getContext("webgl")||e.getContext("experimental-webgl")?d.set("bot_detector_webgl_support",!0):d.set("bot_detector_webgl_support",!1)}function botDetectorCreateClientInfo(){return{agent:"bot_detector_"+t,timestamp:Math.floor((new Date).getTime()/1e3)}}function botDetectorFrontendData(e){var t=botDetectorCreateClientInfo();d.isSet("bot_detector_list_keys_pressed")&&(t.bot_detector_list_keys_pressed=d.get("bot_detector_list_keys_pressed")),d.isSet("bot_detector_headless")&&(t.headless=d.get("bot_detector_headless")),d.isSet("bot_detector_page_hits")&&(t.page_hits=d.get("bot_detector_page_hits")),d.isSet("bot_detector_has_scrolled")&&(t.has_scrolled=d.get("bot_detector_has_scrolled")),d.isSet("bot_detector_mouse_moved")&&(t.mouse_moved=d.get("bot_detector_mouse_moved")),d.isSet("bot_detector_pointer_data")&&(t.pointer_data=d.get("bot_detector_pointer_data")),d.isSet("bot_detector_screen_info")&&(t.screen_info=d.get("bot_detector_screen_info")),d.isSet("bot_detector_user_agent")&&(t.user_agent=d.get("bot_detector_user_agent")),d.isSet("bot_detector_referrer")&&(t.REFFERRER=d.get("bot_detector_referrer")),d.isSet("bot_detector_referrer_previous")&&(t.REFFERRER_PREVIOUS=d.get("bot_detector_referrer_previous")),d.isSet("bot_detector_browser_supports_cookies")&&(t.cookies_enabled=d.get("bot_detector_browser_supports_cookies")),d.isSet("bot_detector_has_input_focused")&&(t.has_input_focused=d.get("bot_detector_has_input_focused")),d.isSet("bot_detector_has_key_up")&&(t.has_key_up=d.get("bot_detector_has_key_up")),d.isSet("bot_detector_webgl_support")&&(t.webgl=d.get("bot_detector_webgl_support")),d.isSet("bot_detector_scrolling_additional")&&(t.scrolling_additional=d.get("bot_detector_scrolling_additional")),"submit"===e&&document.typoData&&(t.typo=document.typoData.data),botDetectorSendClientInfoToCloud(t,e)}function botDetectorSendClientInfoToCloud(e,t){t={event_token:d.isSet("bot_detector_event_token")&&d.isAlive("bot_detector_event_token")?d.get("bot_detector_event_token"):null,js_event:t,page_url:window.location.href,data:e};let r=S.getRecordInstance();r.frontend_data=t,r.timestamp_on_send=Math.floor((new Date).getTime()/1e3),1<Object.keys(e).length&&a.send("frontend_data",t).then(e=>{r.responder_data.headers=e.getAllResponseHeaders(),r.timestamp_on_received=Math.floor((new Date).getTime()/1e3);try{var t,o=JSON.parse(e.response);"SUCCESS"===o.data.operation_status?(d.set("bot_detector_event_token",o.event_token),r.forms_processed=setEventTokenFieldsToForms(o.event_token),r.responder_data.new_event_token=o.event_token,r.success=!0):(t="API error: "+o.error_no+" - "+o.error_message,console.log(t),r.error=t),r.responder_data.host_name=o.hasOwnProperty("host_name")?o.host_name:"not provided"}catch(e){r.error=e.toString(),console.log("Can not parse the response. "+e.toString())}}).catch(e=>{console.log(e.toString()),r.error=e.toString()}).finally(()=>{!0===S.enabled&&S.writeLog(r)})}function setEventTokenFieldsToForms(t){var e,o={forms_count:0,forms_list:[],forms_handling_error:""};if("string"!=typeof t||64!==t.length)e="API error: no valid bot detector event token found in server response.",console.warn(e),o.forms_handling_error=e;else{var a=document.forms;if(d.delete("ct_bot_detector_form_exclusion"),0<a.length)for(let e=0;e<a.length;e++){var r=isFromExcludedFromEventTokenField(a[e],_);if(!1!==r){let e;try{e=JSON.stringify(r)}catch{e=JSON.stringify("JSON error")}d.set("ct_bot_detector_form_exclusion",e)}else if(setEventTokenFormField(a[e],t,e)){o.forms_count++;var s=a[e].attributes,n={};for(let e=0;e<s.length;e++)s[e].name&&s[e].value&&(n[s[e].name]=s[e].value);o.forms_list.push(n)}}}return o}function setEventTokenFormField(e,t,o){if(void 0!==e.elements.ct_bot_detector_event_token)return e.elements.ct_bot_detector_event_token.value=t,!1;var a=document.createElement("input");a.setAttribute("type","hidden");let r=100+Math.floor(899*Math.random());return r=r.toString()+o.toString().substring(-1),a.setAttribute("id","ct_bot_detector_event_token_"+r),a.setAttribute("name","ct_bot_detector_event_token"),a.value=t,e.append(a),!0}async function botDetectorGetFingerprint(){var e=new c,t={f_hash:"",error_msg:"",success:!1,sent:!1};try{return t.f_hash=await e.collectFingerprint(),t.success=!0,t}catch(e){return t.error_msg=e.toString(),t}}"loading"!==document.readyState?botDetectorInit():document.addEventListener("DOMContentLoaded",botDetectorInit),window.addEventListener("mousemove",botDetectorGetMouseData),window.addEventListener("mousemove",botDetectorSetMouseMoved),window.addEventListener("scroll",botDetectorSetHasScrolled),window.addEventListener("scroll",botDetectorCollectScrollingParameters),window.addEventListener("animationstart",botDetectorOnAnimationStart,!0),window.addEventListener("input",botDetectorOnInput,!0)}